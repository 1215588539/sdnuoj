/*!
 * SDNU Online Judge
 * https://github.com/sdnuacmicpc/sdnuoj
 *
 * Copyright 2012-2015 SDNU ACM-ICPC TEAM
 * Licensed under the MIT license
 */
var SDNUOJ=SDNUOJ||{};SDNUOJ.namespace=function(n){var t=n.split("."),r=SDNUOJ,i;for(t[0]==="SDNUOJ"&&(t=t.slice(1)),i=0;i<t.length;i+=1)typeof r[t[i]]=="undefined"&&(r[t[i]]={}),r=r[t[i]];return r};SDNUOJ.PM={SOURCEVIEW:2,ADMINISTRATOR:128,NEWSMANAGE:256,RESOURCEMANAGE:512,FORUMMANAGE:1024,PROBLEMMANAGE:2048,CONTESTMANAGE:4096,SOLUTIONMANAGE:8192,SUPERADMINISTRATOR:1073741822};SDNUOJ.namespace("SDNUOJ.util.cookies");SDNUOJ.util.cookies=function(){return{set:function(n,t,i,r,u){var f=n+"="+escape(t),e;i>0&&(e=new Date,e.setTime(e.getTime()+i*1e3),f+=";expires="+e.toGMTString());r!=null&&(f+=";path="+r);u&&(f+=";secure");document.cookie=f},get:function(n){for(var i,r=document.cookie.split("; "),t=0;t<r.length;t++)if(i=r[t].split("="),i[0]==n)return unescape(i[1]);return""},remove:function(n){document.cookie=n+"=;expires="+new Date(0).toGMTString()}}}();SDNUOJ.namespace("SDNUOJ.util.storage");SDNUOJ.util.storage=function(){var n=SDNUOJ.util.cookies;return{set:function(t,i,r){var u=(new Date).getTime();window.sessionStorage?(window.sessionStorage[t]=i,window.sessionStorage[t+"_timeset"]=u,window.sessionStorage[t+"_timeout"]=r):n.set(t,i,r,"/",!0)},get:function(t){var e=(new Date).getTime(),r,f,u,i;return window.sessionStorage?(r=window.sessionStorage[t+"_timeset"],u=window.sessionStorage[t+"_timeout"],i=window.sessionStorage[t],(r==null||u==null)&&(i=null),i!=null&&r!=null&&u!=null&&(f=(e-r)/1e3,f>u&&(i=null))):i=n.get(t),i!=""?i:null},clear:function(){window.sessionStorage&&window.sessionStorage.clear()}}}();SDNUOJ.namespace("SDNUOJ.util.date");SDNUOJ.util.date=function(){var n=["日","一","二","三","四","五","六"],t=["星期日","星期一","星期二","星期三","星期四","星期五","星期六"];return{format:function(i,r){if(i){r||(r="yyyy-MM-dd HH:mm:ss");switch(typeof i){case"string":i=new Date(i.replace(/-/g,"/"));break;case"number":i=new Date(i)}if(!(!i instanceof Date)){var u={yyyy:i.getFullYear(),M:i.getMonth()+1,d:i.getDate(),H:i.getHours(),m:i.getMinutes(),s:i.getSeconds(),MM:(""+(i.getMonth()+101)).substr(1),dd:(""+(i.getDate()+100)).substr(1),HH:(""+(i.getHours()+100)).substr(1),mm:(""+(i.getMinutes()+100)).substr(1),ss:(""+(i.getSeconds()+100)).substr(1),ddd:n[i.getDay()],dddd:t[i.getDay()]};return r.replace(/(yyyy|MM?|d{1,4}|HH?|ss?|mm?)/g,function(){return u[arguments[0]]})}}}}}();SDNUOJ.namespace("SDNUOJ.util.form");SDNUOJ.util.form=function(){function n(n){for(var t,r=n.find("input,textarea"),i=0;i<r.length;i++)if(t=$(r[i]),!t.is(":hidden")||t.is("textarea[data-editor='true']")){if(t.attr("data-emptyinfo")&&t.val()=="")return alert(t.attr("data-emptyinfo")),!1;if(t.attr("data-comparedto")&&t.attr("data-notequalinfo")&&t.val()!=$("#"+t.attr("data-comparedto")).val())return alert(t.attr("data-notequalinfo")),!1;if(t.attr("data-regex")&&t.attr("data-invalidinfo")&&!new RegExp(t.attr("data-regex")).test(t.val()))return alert(t.attr("data-invalidinfo")),!1}return!0}function t(n,t){var i=t||window.event,r=i.keyCode||i.which||i.charCode;i.ctrlKey&&r==13&&n.parents("form").trigger("submit")}return{verifyForm:n,setFormAutoVerify:function(){$("form[data-verify='true']").submit(function(){return n($(this))})},quickSubmit:t,setTextboxQuickSubmit:function(){$("input[data-quicksubmit='true'],textarea[data-quicksubmit='true']").keydown(function(n){return t($(this),n)})}}}();SDNUOJ.namespace("SDNUOJ.util.dom");SDNUOJ.util.dom=function(){return{getCheckboxValue:function(n){for(var i="",r=0,t=0;t<n.length;t++)n[t].checked&&(r>0&&(i+=","),i+=$(n[t]).val(),r++);return r>0?i:null},getRadioValue:function(n){for(var t=0;t<n.length;t++)if(n[t].checked)return $(n[t]).val();return null},getValue:function(n){var t=$("input[name='"+n+"'],select[name='"+n+"'],textarea[name='"+n+"']");return t.length<=0?null:t.is("input[type='checkbox']")?this.getCheckboxValue(t):t.is("input[type='radio']")?this.getRadioValue(t):t.val()}}}();SDNUOJ.namespace("SDNUOJ.util.file");SDNUOJ.util.file=function(){return{getFileExtension:function(n){return n.substring(n.lastIndexOf(".")).toLowerCase()}}}();SDNUOJ.namespace("SDNUOJ.util.list");SDNUOJ.util.list=function(){function n(n){for(var i=$("input[name='"+n.attr("data-selectall-name")+"']"),t=0;t<i.length;t++)i[t].checked=n[0].checked}return{selectAll:n,setCheckboxSelectAll:function(){$("input[data-selectall-name]").change(function(){return n($(this))})}}}();SDNUOJ.namespace("SDNUOJ.util.loader");SDNUOJ.util.loader=function(){return{load:function(n){for(var u=typeof n=="string"?[n]:n,t=0;t<u.length;t++){var f=u[t],e=f.split("."),s=e[e.length-1].toLowerCase(),i=s=="css",r=i?"link":"script",h=i?' type="text/css" rel="stylesheet" ':' language="javascript" type="text/javascript" ',o=(i?"href":"src")+'="'+f+'"';$(r+"["+o+"]").length==0&&document.write("<"+r+h+o+"><\/"+r+">")}}}}();SDNUOJ.namespace("SDNUOJ.util.browser");SDNUOJ.util.browser=function(){return{ltIE8:function(){var i=navigator.appName,r=navigator.appVersion,n=r.split(";"),t=n&&n.length>1?n[1].replace(/[ ]/g,""):"";return i=="Microsoft Internet Explorer"&&(t=="MSIE6.0"||t=="MSIE7.0")?!0:!1}}}();SDNUOJ.namespace("SDNUOJ.user");SDNUOJ.user=function(){function i(n){return(l&n)==n}var t=SDNUOJ.util.cookies,r=SDNUOJ.util.storage,u="_oj_",e=u+"bs",o=u+"la",s=u+"sl",h=t.get(e),n=h!=""?h.split("|"):null,c=n!=null?n[0]:"",l=n!=null?n[1]:"",f=n!=null?n[2]:"",a;return f==""&&(f="0"),a=function(){var n=!1;return c==""?t.remove(e):n=!0,n||r.clear(),n}(),{getIsLogined:function(){return a},getCurrentUserName:function(){return c},getCurrentPermission:function(){return l},getUnreadMail:function(){return f},getLastLanguage:function(){var n=t.get(o);return!n||n==""?0:parseInt(n)},setLastLanguage:function(n){t.set(o,n,31536e3,"/")},hasPermission:function(n){return i(n)},hasSourceViewPermission:function(){return i(SDNUOJ.PM.SOURCEVIEW)},hasAdministratorPermission:function(){return i(SDNUOJ.PM.ADMINISTRATOR)},hasContestManagePermission:function(){return i(SDNUOJ.PM.CONTESTMANAGE)},getSubmitList:function(n){var t=r.get(s);if(t!=null){n($.parseJSON(t));return}$.getJSON("/solution/submitlist").done(function(t){r.set(s,JSON.stringify(t),30);n(t)})}}}();SDNUOJ.namespace("SDNUOJ.admin.framework");SDNUOJ.admin.framework=function(){function r(n){if(!t.hasPermission(n.permission)||n.accessOnly&&$("#menus").attr("data-isaccessdb").toLowerCase()!="true")return!1;return $("<a>").attr("href","javascript:void(0);").attr("data-menuid",n.id).addClass(n.id==1?"menu-open":"menu-close").append($("<span>").html(n.title)).click(function(){$("#menus a.menu-open").removeClass("menu-open").addClass("menu-close");$(this).removeClass("menu-close").addClass("menu-open");i($(this).attr("data-menuid"))})}function u(n,i){if(!t.hasPermission(n.permission))return!1;return $("<a>").attr("href","/admin/"+n.url).attr("target","admin-page").html(n.title).addClass(i?"submenu-open":"submenu-close").click(function(){$("#submenus a.submenu-open").removeClass("submenu-open").addClass("submenu-close");$(this).removeClass("submenu-close").addClass("submenu-open")})}function f(){for(var i,t=0;t<n.length;t++)i=r(n[t]),i&&$("#menus").append(i)}function i(i){var f,r,e,o;if($("#submenus").html(""),!t.hasAdministratorPermission())return!1;for(f=null,r=0;r<n.length;r++)if(n[r].id==i){f=n[r];break}if(f==null)return!1;for(r=0;r<f.allmenus.length;r++)e=u(f.allmenus[r],r==f.defaultSubID),e&&$("#submenus").append(e);o=f.defaultSubID;window.parent.frames["admin-page"].document.location.href="/admin/"+f.allmenus[o].url}var t=SDNUOJ.user,n=[{id:1,title:"常规管理",permission:SDNUOJ.PM.ADMINISTRATOR,accessOnly:!1,defaultSubID:0,allmenus:[{title:"系统综合信息",permission:SDNUOJ.PM.ADMINISTRATOR,url:"welcome"},{title:"系统信息检测",permission:SDNUOJ.PM.SUPERADMINISTRATOR,url:"system/info"},{title:"系统公告管理",permission:SDNUOJ.PM.NEWSMANAGE,url:"news/list"},{title:"上传文件管理",permission:SDNUOJ.PM.ADMINISTRATOR,url:"upload/list"},{title:"下载资源管理",permission:SDNUOJ.PM.RESOURCEMANAGE,url:"resource/list"},{title:"专题页面管理",permission:SDNUOJ.PM.SUPERADMINISTRATOR,url:"topicpage/list"},{title:"运行参数管理",permission:SDNUOJ.PM.SUPERADMINISTRATOR,url:"system/config"},{title:"系统缓存管理",permission:SDNUOJ.PM.SUPERADMINISTRATOR,url:"system/cachelist"}]},{id:2,title:"题目管理",permission:SDNUOJ.PM.PROBLEMMANAGE,accessOnly:!1,defaultSubID:0,allmenus:[{title:"题目信息添加",permission:SDNUOJ.PM.PROBLEMMANAGE,url:"problem/add"},{title:"题目信息导入",permission:SDNUOJ.PM.SUPERADMINISTRATOR,url:"problem/import"},{title:"题目综合管理",permission:SDNUOJ.PM.PROBLEMMANAGE,url:"problem/list"},{title:"题目分类管理",permission:SDNUOJ.PM.PROBLEMMANAGE,url:"problem/categorylist"}]},{id:3,title:"竞赛管理",permission:SDNUOJ.PM.CONTESTMANAGE,accessOnly:!1,defaultSubID:0,allmenus:[{title:"竞赛信息添加",permission:SDNUOJ.PM.CONTESTMANAGE,url:"contest/add"},{title:"竞赛综合管理",permission:SDNUOJ.PM.CONTESTMANAGE,url:"contest/list"}]},{id:4,title:"用户管理",permission:SDNUOJ.PM.SUPERADMINISTRATOR,accessOnly:!1,defaultSubID:0,allmenus:[{title:"在线用户查看",permission:SDNUOJ.PM.SUPERADMINISTRATOR,url:"user/online"},{title:"用户密码修改",permission:SDNUOJ.PM.SUPERADMINISTRATOR,url:"user/changepassword"},{title:"用户信息管理",permission:SDNUOJ.PM.SUPERADMINISTRATOR,url:"user/list"},{title:"用户权限管理",permission:SDNUOJ.PM.SUPERADMINISTRATOR,url:"user/permissionlist"}]},{id:5,title:"论坛管理",permission:SDNUOJ.PM.FORUMMANAGE,accessOnly:!1,defaultSubID:0,allmenus:[{title:"论坛主题管理",permission:SDNUOJ.PM.FORUMMANAGE,url:"forum/topiclist"},{title:"论坛帖子管理",permission:SDNUOJ.PM.FORUMMANAGE,url:"forum/postlist"}]},{id:6,title:"评测管理",permission:SDNUOJ.PM.SOLUTIONMANAGE,accessOnly:!1,defaultSubID:t.hasPermission(SDNUOJ.PM.SUPERADMINISTRATOR)?0:2,allmenus:[{title:"评测机管理",permission:SDNUOJ.PM.SUPERADMINISTRATOR,url:"judger/list"},{title:"提交评测管理",permission:SDNUOJ.PM.SUPERADMINISTRATOR,url:"solution/list"},{title:"重新评测提交",permission:SDNUOJ.PM.SOLUTIONMANAGE,url:"solution/rejudge"}]},{id:7,title:"数据库管理",permission:SDNUOJ.PM.SUPERADMINISTRATOR,accessOnly:!0,defaultSubID:0,allmenus:[{title:"系统数据库压缩",permission:SDNUOJ.PM.SUPERADMINISTRATOR,url:"database/compact"},{title:"系统数据库备份",permission:SDNUOJ.PM.SUPERADMINISTRATOR,url:"database/backup"},{title:"系统数据库还原",permission:SDNUOJ.PM.SUPERADMINISTRATOR,url:"database/restore"},{title:"系统数据库上传",permission:SDNUOJ.PM.SUPERADMINISTRATOR,url:"database/upload"},{title:"系统数据库管理",permission:SDNUOJ.PM.SUPERADMINISTRATOR,url:"database/list"}]}];return{showMenus:f,showSubMenus:i}}(),function(){SDNUOJ.admin.framework.showMenus();SDNUOJ.admin.framework.showSubMenus(1);SDNUOJ.util.browser.ltIE8()&&(alert("您的浏览器版本小于Internet Explorer 8，部分功能将无法使用，请更新您的浏览器或使用其他浏览器！"),window.close())}();