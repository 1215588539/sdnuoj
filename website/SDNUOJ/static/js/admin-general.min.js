/*!
 * SDNU Online Judge
 * https://github.com/sdnuacmicpc/sdnuoj
 *
 * Copyright 2012-2015 SDNU ACM-ICPC TEAM
 * Licensed under the MIT license
 */
var SDNUOJ=SDNUOJ||{};SDNUOJ.namespace=function(n){var t=n.split("."),r=SDNUOJ,i;for(t[0]==="SDNUOJ"&&(t=t.slice(1)),i=0;i<t.length;i+=1)typeof r[t[i]]=="undefined"&&(r[t[i]]={}),r=r[t[i]];return r};SDNUOJ.PM={SOURCEVIEW:2,ADMINISTRATOR:128,NEWSMANAGE:256,RESOURCEMANAGE:512,FORUMMANAGE:1024,PROBLEMMANAGE:2048,CONTESTMANAGE:4096,SOLUTIONMANAGE:8192,SUPERADMINISTRATOR:1073741822};SDNUOJ.namespace("SDNUOJ.util.cookies");SDNUOJ.util.cookies=function(){return{set:function(n,t,i,r,u){var f=n+"="+escape(t),e;i>0&&(e=new Date,e.setTime(e.getTime()+i*1e3),f+=";expires="+e.toGMTString());r!=null&&(f+=";path="+r);u&&(f+=";secure");document.cookie=f},get:function(n){for(var i,r=document.cookie.split("; "),t=0;t<r.length;t++)if(i=r[t].split("="),i[0]==n)return unescape(i[1]);return""},remove:function(n){document.cookie=n+"=;expires="+new Date(0).toGMTString()}}}();SDNUOJ.namespace("SDNUOJ.util.storage");SDNUOJ.util.storage=function(){var n=SDNUOJ.util.cookies;return{set:function(t,i,r){var u=(new Date).getTime();window.sessionStorage?(window.sessionStorage[t]=i,window.sessionStorage[t+"_timeset"]=u,window.sessionStorage[t+"_timeout"]=r):n.set(t,i,r,"/",!0)},get:function(t){var e=(new Date).getTime(),r,f,u,i;return window.sessionStorage?(r=window.sessionStorage[t+"_timeset"],u=window.sessionStorage[t+"_timeout"],i=window.sessionStorage[t],(r==null||u==null)&&(i=null),i!=null&&r!=null&&u!=null&&(f=(e-r)/1e3,f>u&&(i=null))):i=n.get(t),i!=""?i:null},clear:function(){window.sessionStorage&&window.sessionStorage.clear()}}}();SDNUOJ.namespace("SDNUOJ.util.date");SDNUOJ.util.date=function(){var n=["日","一","二","三","四","五","六"],t=["星期日","星期一","星期二","星期三","星期四","星期五","星期六"];return{format:function(i,r){if(i){r||(r="yyyy-MM-dd HH:mm:ss");switch(typeof i){case"string":i=new Date(i.replace(/-/g,"/"));break;case"number":i=new Date(i)}if(!(!i instanceof Date)){var u={yyyy:i.getFullYear(),M:i.getMonth()+1,d:i.getDate(),H:i.getHours(),m:i.getMinutes(),s:i.getSeconds(),MM:(""+(i.getMonth()+101)).substr(1),dd:(""+(i.getDate()+100)).substr(1),HH:(""+(i.getHours()+100)).substr(1),mm:(""+(i.getMinutes()+100)).substr(1),ss:(""+(i.getSeconds()+100)).substr(1),ddd:n[i.getDay()],dddd:t[i.getDay()]};return r.replace(/(yyyy|MM?|d{1,4}|HH?|ss?|mm?)/g,function(){return u[arguments[0]]})}}}}}();SDNUOJ.namespace("SDNUOJ.util.form");SDNUOJ.util.form=function(){function n(n){for(var t,r=n.find("input,textarea"),i=0;i<r.length;i++)if(t=$(r[i]),!t.is(":hidden")||t.is("textarea[data-editor='true']")){if(t.attr("data-emptyinfo")&&t.val()=="")return alert(t.attr("data-emptyinfo")),!1;if(t.attr("data-comparedto")&&t.attr("data-notequalinfo")&&t.val()!=$("#"+t.attr("data-comparedto")).val())return alert(t.attr("data-notequalinfo")),!1;if(t.attr("data-regex")&&t.attr("data-invalidinfo")&&!new RegExp(t.attr("data-regex")).test(t.val()))return alert(t.attr("data-invalidinfo")),!1}return!0}function t(n,t){var i=t||window.event,r=i.keyCode||i.which||i.charCode;i.ctrlKey&&r==13&&n.parents("form").trigger("submit")}return{verifyForm:n,setFormAutoVerify:function(){$("form[data-verify='true']").submit(function(){return n($(this))})},quickSubmit:t,setTextboxQuickSubmit:function(){$("input[data-quicksubmit='true'],textarea[data-quicksubmit='true']").keydown(function(n){return t($(this),n)})}}}();SDNUOJ.namespace("SDNUOJ.util.dom");SDNUOJ.util.dom=function(){return{getCheckboxValue:function(n){for(var i="",r=0,t=0;t<n.length;t++)n[t].checked&&(r>0&&(i+=","),i+=$(n[t]).val(),r++);return r>0?i:null},getRadioValue:function(n){for(var t=0;t<n.length;t++)if(n[t].checked)return $(n[t]).val();return null},getValue:function(n){var t=$("input[name='"+n+"'],select[name='"+n+"'],textarea[name='"+n+"']");return t.length<=0?null:t.is("input[type='checkbox']")?this.getCheckboxValue(t):t.is("input[type='radio']")?this.getRadioValue(t):t.val()}}}();SDNUOJ.namespace("SDNUOJ.util.file");SDNUOJ.util.file=function(){return{getFileExtension:function(n){return n.substring(n.lastIndexOf(".")).toLowerCase()}}}();SDNUOJ.namespace("SDNUOJ.util.list");SDNUOJ.util.list=function(){function n(n){for(var i=$("input[name='"+n.attr("data-selectall-name")+"']"),t=0;t<i.length;t++)i[t].checked=n[0].checked}return{selectAll:n,setCheckboxSelectAll:function(){$("input[data-selectall-name]").change(function(){return n($(this))})}}}();SDNUOJ.namespace("SDNUOJ.util.loader");SDNUOJ.util.loader=function(){return{load:function(n){for(var u=typeof n=="string"?[n]:n,t=0;t<u.length;t++){var f=u[t],e=f.split("."),s=e[e.length-1].toLowerCase(),i=s=="css",r=i?"link":"script",h=i?' type="text/css" rel="stylesheet" ':' language="javascript" type="text/javascript" ',o=(i?"href":"src")+'="'+f+'"';$(r+"["+o+"]").length==0&&document.write("<"+r+h+o+"><\/"+r+">")}}}}();SDNUOJ.namespace("SDNUOJ.util.browser");SDNUOJ.util.browser=function(){return{ltIE8:function(){var i=navigator.appName,r=navigator.appVersion,n=r.split(";"),t=n&&n.length>1?n[1].replace(/[ ]/g,""):"";return i=="Microsoft Internet Explorer"&&(t=="MSIE6.0"||t=="MSIE7.0")?!0:!1}}}();SDNUOJ.namespace("SDNUOJ.user");SDNUOJ.user=function(){function i(n){return(l&n)==n}var t=SDNUOJ.util.cookies,r=SDNUOJ.util.storage,u="_oj_",e=u+"bs",o=u+"la",s=u+"sl",h=t.get(e),n=h!=""?h.split("|"):null,c=n!=null?n[0]:"",l=n!=null?n[1]:"",f=n!=null?n[2]:"",a;return f==""&&(f="0"),a=function(){var n=!1;return c==""?t.remove(e):n=!0,n||r.clear(),n}(),{getIsLogined:function(){return a},getCurrentUserName:function(){return c},getCurrentPermission:function(){return l},getUnreadMail:function(){return f},getLastLanguage:function(){var n=t.get(o);return!n||n==""?0:parseInt(n)},setLastLanguage:function(n){t.set(o,n,31536e3,"/")},hasPermission:function(n){return i(n)},hasSourceViewPermission:function(){return i(SDNUOJ.PM.SOURCEVIEW)},hasAdministratorPermission:function(){return i(SDNUOJ.PM.ADMINISTRATOR)},hasContestManagePermission:function(){return i(SDNUOJ.PM.CONTESTMANAGE)},getSubmitList:function(n){var t=r.get(s);if(t!=null){n($.parseJSON(t));return}$.getJSON("/solution/submitlist").done(function(t){r.set(s,JSON.stringify(t),30);n(t)})}}}();SDNUOJ.namespace("SDNUOJ.admin.editor");SDNUOJ.admin.editor=function(){function t(t,i,r){if(t){r||(r={});r.id=i;r.cssfile=["/static/css/foundation/bootstrap-3.3.4.min.css","/static/css/foreground.min.css"];r.css="html { position: static; } body { margin:0; padding: 0; }";var u=new t.edit("editor"+n.length,r);n.push(u)}}var n=[];return{addEditor:t,setAllEditors:function(){$("textarea[data-editor='true']").length>0&&$.ajax("/static/js/foundation/tinyeditor.min.js",{async:!1,cache:!0,dataType:"script",success:function(){var n=null;"undefined"!=typeof TINY&&(n=TINY.editor);$("textarea[data-editor='true']").each(function(){var i=$(this),r={};i.attr("data-width")&&(r.width=i.attr("data-width"));i.attr("data-height")&&(r.height=i.attr("data-height"));t(n,i.attr("id"),r)})}})},getAll:function(){return n}}}();SDNUOJ.namespace("SDNUOJ.admin.page");SDNUOJ.admin.page=function(){function t(){var n=$("<div>"),t=$("<div>").addClass("loading-img"),i=$("<p>").addClass("loading-info").html("正在操作，请稍后"),r=$("<div>").addClass("loading-tip").append(t).append(i);$(n).addClass("loading-overlay").css("display","none").append(r).appendTo("body");n.delay(100).fadeIn("normal",function(){$("#container").addClass("loading-container")})}function n(n){self.location="/admin/info?c="+n}function i(n){var t=SDNUOJ.util.dom.getValue(n);return t==null?(alert("请至少选择一项内容进行操作！"),null):t}function r(n){if("undefined"!=typeof n){var t=n.init;"undefined"!=typeof t&&t()}}return{is:function(n){var t=$("#page-bottominfo").attr("data-type");return n==t},initPage:function(){var u=$("#page-bottominfo").attr("data-type"),i,t,f,n;if(u!="")for(i=u.split("."),n=SDNUOJ.admin.pages,t=0;t<i.length;t++)f=i[t],n=n[f],r(n)},showWaiting:t,showError:n,setForm:function(){$("form").submit(function(){for(var i=$(this),r=SDNUOJ.admin.editor.getAll(),n=0;n<r.length;n++)r[n]&&r[n].post&&r[n].post();return i.attr("data-verify")=="true"&&!SDNUOJ.util.form.verifyForm(i)?!1:i.attr("data-confirm")=="true"&&!window.confirm("您确定要执行此操作？")?!1:(i.attr("data-waiting")=="true"&&t(),!0)})},setPager:function(){$("select[data-pager='true']").change(function(){var n=$(this),i=n[0],t=n.attr("data-urltemplate").replace("__page__",n.val());self.location=t})},setAdvanceLink:function(){$("a[data-advancelink='true']").each(function(){var u=/__[a-zA-Z0-9]+__/,r=$(this);r.attr("data-url",r.attr("href")).attr("href","javascript:void(0);").click(function(){for(var f=r.attr("data-url"),e=u.exec(f),s,o;e!=null;){if(s=e.toString().replace(/__([a-zA-Z0-9]+)__/,"$1"),o=i(s),o==null)return;f=f.replace(e,o);e=u.exec(f)}if(r.attr("data-confirm")=="true"&&!window.confirm("您确定要执行此操作？"))return!1;r.attr("data-async")=="true"?(t(),$.getJSON(f).done(function(t){t&&t.status=="success"?location.reload():t&&t.status=="fail"?n(t.result):n("The operation failed for an unspecified or unknown reason.")}).fail(function(){n("The operation failed.")})):self.location=f})})},setSwitchLink:function(){$("a[data-switch-name][data-switch-value]").each(function(){var n=$(this),r=n.attr("data-switch-name"),i=n.attr("data-switch-value"),t=$("input[name='"+r+"']");if(t.length!=0){var u=t.val(),f=n.html(),e=$("<span>").addClass(i==u?"link-selected":"link-normal").html(f);n.html("");n.append(e);n.attr("href","javascript:void(0);").click(function(){t.val(i);n.parents("form").submit()})}})},setCollapseLink:function(){$("a[data-collapse='true']").each(function(){var n=$(this);n.attr("href","javascript:void(0);").click(function(){var i=n.parents("table"),r=i.find(".collapse-item").length,t="unknown";n.hasClass("button-expand")?(n.removeClass("button-expand"),n.addClass("button-collapse"),t="expanded"):n.hasClass("button-collapse")&&(n.removeClass("button-collapse"),n.addClass("button-expand"),t="collapsed");i.find("tr[data-collapsed='true']").each(function(){t=="expanded"?$(this).removeClass("collapsed"):t=="collapsed"&&$(this).addClass("collapsed")})})})},setButtonLink:function(){$("input[type='button'][data-navigateurl],button[data-navigateurl]").click(function(){var n=$(this);if(n.attr("data-confirm")=="true"&&!window.confirm("您确定要执行此操作？"))return!1;self.location=n.attr("data-navigateurl")})},setRadio:function(){$("input[type='radio'][data-hidetarget],input[type='radio'][data-showtarget]").click(function(){var n=$(this);n.attr("data-hidetarget")&&$("#"+n.attr("data-hidetarget")).hide();n.attr("data-showtarget")&&$("#"+n.attr("data-showtarget")).show()})},setDatetimePicker:function(){$(".datetimepicker").length>0&&(SDNUOJ.util.loader.load("/static/css/foundation/jquery.datetimepicker-2.4.3-mod.min.css"),$.ajax("/static/js/foundation/jquery.datetimepicker-2.4.3-mod.min.js",{async:!0,cache:!0,dataType:"script",success:function(){$(".datetimepicker").datetimepicker({lang:"zh",format:"Y-m-d",allowBlank:!0,timepicker:!1,scrollMonth:!1,scrollInput:!1,closeOnDateSelect:!0,yearStart:2012,yearEnd:(new Date).getFullYear()+1})}}))},setSelect:function(){$("select[data-value]").each(function(){for(var i,n=$(this),r=n.attr("data-value"),t=0;t<n[0].options.length;t++)if(i=n[0].options[t],i.value==r){i.selected=!0;break}})},generateSelectItems:function(){$("select[data-value-from][data-value-to]").each(function(){for(var n,t=$(this),u=parseInt(t.attr("data-value-from")),f=parseInt(t.attr("data-value-to")),r=t.attr("data-value-from").length,i=u;i<=f;i++)n=i.toString(),n.length<r&&(n=new Array(r-n.length+1).join("0")+n),t.append($("<option>").html(n))})},disableEnter:function(){$("input[data-disableenter='true'],textarea[data-disableenter='true']").keydown(function(n){var t=n||window.event,i=t.keyCode||t.which||t.charCode;i==13&&(window.event?window.event.returnValue=!1:t.preventDefault())})}}}();SDNUOJ.namespace("SDNUOJ.admin.pages.welcome");SDNUOJ.admin.pages.welcome=function(){function n(n){$("#statistic-chart").css("height","auto").addClass("text-center").html(n);$("#statistic-legend").empty()}return{init:function(){for(var t=new Date,r=$("#admin-year"),i=$("#admin-month"),u=2012;u<=t.getFullYear();u++)r.append($("<option>").html(u).val(u));r.change(function(){var u=$(this).val(),r=12,n;for(u==t.getFullYear()&&(r=t.getMonth()+1),i.empty(),n=1;n<=r;n++)i.append($("<option>").html(n).val(n));i.trigger("change")});r.val(t.getFullYear());r.trigger("change");i.val(t.getMonth()+1);n("正在加载统计信息...");$.getScript("/static/js/foundation/jquery.flot-0.8.3.min.js",function(){i.change(function(){n("正在加载统计信息...");$.getJSON("/admin/welcome/submitstatistic?year="+$("#admin-year").val()+"&month="+$("#admin-month").val()).done(function(t){var i,u,r;if(t&&t.status=="success"){for($("#statistic-chart").css("height","330px").removeClass("text-center").html(""),i=[{data:t.result.all,label:"Submit",lines:{show:!0,lineWidth:3},points:{show:!0},color:"#b3d7fa"},{data:t.result.accepted,label:"Accepted",bars:{show:!0,barWidth:.5,align:"center"},color:"#80d766"}],u=[],r=1;r<=t.result.all.length;r++)u.push(r);$.plot("#statistic-chart",i,{xaxis:{font:{size:12,lineHeight:14,weight:"normal",family:"Arial",color:"#000"},color:"#000",ticks:u,tickColor:"#eaeaea",tickFormatter:function(n){return parseInt(n).toString()}},yaxis:{font:{size:12,lineHeight:14,weight:"normal",family:"Arial",color:"#000"},color:"#000",min:0,ticks:10,tickColor:"#eaeaea"},legend:{container:"#statistic-legend",noColumns:2},grid:{hoverable:!0,borderWidth:0,margin:10,labelMargin:10}});$("#statistic-chart").bind("plothover",function(n,r,u){if(u){var f=u.datapoint[0],e=i[1].data[f-1][1],o=i[0].data[f-1][1],s=t.result.date+"-"+f+" Submission(s):<br/>AC / Total: "+e+" / "+o;$("#statistic-chart-tooltip").html(s).css({top:u.pageY+8,left:u.pageX+8}).fadeIn(200)}else $("#statistic-chart-tooltip").hide()})}else n("统计信息加载失败，请重试！")}).fail(function(){n("统计信息加载失败，请重试！")})}).trigger("change")})}}}();SDNUOJ.namespace("SDNUOJ.admin.pages.problemimport");SDNUOJ.admin.pages.problemimport=function(){return{init:function(){$("#import-filetype").change(function(){var n=$(this).val();n=="0"?($("#tr-file").hide(),$("#tr-content").show()):n=="1"&&($("#tr-content").hide(),$("#tr-file").show())});$("#form-importproblem input[type='reset']").click(function(){$("#tr-file").hide();$("#tr-content").show()})}}}();SDNUOJ.namespace("SDNUOJ.admin.pages.problemcategory");SDNUOJ.admin.pages.problemcategory=function(){function n(){var n="";$("#select-choosed>option").each(function(t){t>0&&(n+=",");n+=$(this).val()});$("#txt-target").val(n)}return{init:function(){$("input[type='button'][data-convert-type],button[data-convert-type]").click(function(){var t=parseInt($(this).attr("data-convert-type")),i=Math.abs(t)>1,r=$(t>0?"#select-unchoosed":"#select-choosed"),u=$(t>0?"#select-choosed":"#select-unchoosed");r.find("option").each(function(){var n=$(this);(i||n[0].selected)&&(n[0].selected=!1,n.remove(),u.append(n.clone()))});n()})}}}();SDNUOJ.namespace("SDNUOJ.admin.pages.problemdata");SDNUOJ.admin.pages.problemdata=function(){function r(){if(n>=t){alert("一个题目最多只能包含"+t+"个数据！");return}var i=f();$("#table-data").append(i);n++}function f(){var t=++i,r="datarow-"+t,h="datarow-left-"+t,f="datarow-right-"+t,c=$("<select>").append($("<option>").html("从文件上传").val("1")).append($("<option>").html("在线编辑数据").val("2")).append($("<option>").html("删除该组数据").val("3")).attr("data-value","1").val("1").change(function(){var i=$(this),o=i.val(),h=$("#"+r),s=$("#"+f);if(o=="1")u(s,t);else if(o=="2")e(s,t);else if(o=="3"){if(n<=1){i.val(i.attr("data-value"));alert("一个题目最少需要包含1个数据！");return}h.remove();return}i.attr("data-value",o)}),o=$("<tr>").attr("id",r),l=$("<td>").attr("id",h).append("题目数据&nbsp;").append(c),s=$("<td>").attr("id",f).css("vertical-align","top");return u(s,t),o.append(l).append(s),o}function u(n,t){var i=function(){return!1},r=$("<input>").attr({id:"in"+t,name:"in"+t,type:"file"}).addClass("uploadbox-tiny").keydown(i),u=$("<input>").attr({id:"out"+t,name:"out"+t,type:"file"}).addClass("uploadbox-tiny").keydown(i);n.empty();n.append($("<p>").append("输入数据&nbsp;").append(r).css("margin","5px 0 5px 0")).append($("<p>").append("输出数据&nbsp;").append(u).css("margin","5px 0 5px 0"))}function e(n,t){var i=$("<textarea>").attr({id:"in"+t,name:"in"+t}).addClass("textarea-tiny"),r=$("<textarea>").attr({id:"out"+t,name:"out"+t}).addClass("textarea-tiny");n.empty();n.append("输入数据&nbsp;").append(i).append("<br/>").append("输出数据&nbsp;").append(r)}function o(){for(var n,t,u,r=1;r<=i;r++){if(n=$("#in"+r),t=$("#out"+r),n.is("input[type='file']")){if(n.val()=="")return alert("题目输入数据文件选择不全，请重新选择！"),!1;if(u=SDNUOJ.util.file.getFileExtension(n.val()),u!=".in")return alert("题目输入数据文件类型有误，请重新选择！"),!1}if(t.is("input[type='file']")){if(t.val()=="")return alert("题目输出数据文件选择不全，请重新选择！"),!1;if(u=SDNUOJ.util.file.getFileExtension(t.val()),u!=".out"&&u!=".ans")return alert("题目输出数据文件类型有误，请重新选择！"),!1}if(n.is("textarea")&&n.val()=="")return alert("题目输入数据设置不全，请重新输入！"),!1;if(t.is("textarea")&&t.val()=="")return alert("题目输出数据设置不全，请重新输入！"),!1}return!0}var t=10,n=0,i=0;return{init:function(){$("#btn-adddata").attr("href","javascript:void(0);").click(function(){r()});$("#form-createproblemdata").submit(function(){var n=$(this);if(!SDNUOJ.util.form.verifyForm(n)||!o())return!1;SDNUOJ.admin.page.showWaiting()});r()}}}(),function(){SDNUOJ.util.browser.ltIE8()&&($("#browser-warning").show(),window.close());SDNUOJ.admin.page.setForm();SDNUOJ.admin.page.setPager();SDNUOJ.admin.page.setAdvanceLink();SDNUOJ.admin.page.setSwitchLink();SDNUOJ.admin.page.setCollapseLink();SDNUOJ.admin.page.setButtonLink();SDNUOJ.admin.page.setRadio();SDNUOJ.admin.page.setDatetimePicker();SDNUOJ.admin.page.generateSelectItems();SDNUOJ.admin.page.setSelect();SDNUOJ.admin.page.disableEnter();SDNUOJ.admin.editor.setAllEditors();SDNUOJ.util.list.setCheckboxSelectAll();SDNUOJ.admin.page.initPage()}();